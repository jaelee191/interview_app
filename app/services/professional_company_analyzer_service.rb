class ProfessionalCompanyAnalyzerService
  def initialize(company_name)
    @company_name = company_name
    @api_key = ENV['OPENAI_API_KEY']
  end

  def perform_professional_analysis
    {
      executive_summary: generate_executive_summary,
      company_overview: analyze_company_overview,
      industry_market_analysis: analyze_industry_market,
      financial_analysis: analyze_financials,
      strategic_direction: analyze_strategy,
      risk_factors: analyze_risks,
      future_outlook: generate_outlook,
      key_insights: generate_insights,
      metadata: {
        analysis_date: Time.current,
        analysis_version: '2.0',
        methodology: 'McKinsey/BCG Framework'
      }
    }
  end

  private

  def generate_executive_summary
    prompt = <<~PROMPT
      ê¸°ì—…ëª…: #{@company_name}
      í˜„ì¬ ë‚ ì§œ: #{Time.current.strftime('%Yë…„ %mì›”')}
      
      **ì¤‘ìš”**: 2025ë…„ 8ì›” ê¸°ì¤€ ê°€ì¥ ìµœì‹  ì •ë³´ë¥¼ ë°˜ì˜í•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”. 2025ë…„ ìƒë°˜ê¸° ì‹¤ì , ìµœê·¼ ë°œí‘œ, í˜„ì¬ ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ ë“±ì„ í¬í•¨í•˜ì„¸ìš”.
      
      ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ Executive Summaryë¥¼ ì‘ì„±í•˜ì„¸ìš”:
      
      ## Executive Summary
      
      ### í•µì‹¬ ìš”ì•½ (3ì¤„)
      â€¢ [2025ë…„ í˜„ì¬ ê¸°ì—…ì˜ ìœ„ì¹˜ì™€ í•µì‹¬ ê°•ì ]
      â€¢ [2025ë…„ ë‹¹ë©´í•œ ì£¼ìš” ë„ì „ê³¼ì œ ë° ê¸°íšŒ]
      â€¢ [2025-2026ë…„ ì „ë§ê³¼ í•µì‹¬ ì œì–¸]
      
      ### íˆ¬ì í¬ì¸íŠ¸ (2025ë…„ ê¸°ì¤€)
      â€¢ ê°•ì  1: [2025ë…„ ìµœì‹  ë°ì´í„° ê¸°ë°˜ ì„¤ëª…]
      â€¢ ê°•ì  2: [êµ¬ì²´ì  ì„¤ëª…]
      â€¢ ê°•ì  3: [êµ¬ì²´ì  ì„¤ëª…]
      
      ### ì£¼ìš” ë¦¬ìŠ¤í¬ (2025ë…„ ê¸°ì¤€)
      â€¢ ë¦¬ìŠ¤í¬ 1: [2025ë…„ í˜„ì¬ ìƒí™© ë°˜ì˜]
      â€¢ ë¦¬ìŠ¤í¬ 2: [êµ¬ì²´ì  ì„¤ëª…]
      
      ### ì „ëµì  ì œì–¸
      â€¢ ë‹¨ê¸°(2025ë…„ í•˜ë°˜ê¸°-2026ë…„ ìƒë°˜ê¸°): [êµ¬ì²´ì  í–‰ë™ ë°©ì•ˆ]
      â€¢ ì¤‘ê¸°(2026-2028ë…„): [ì „ëµì  ë°©í–¥ì„±]
      
      2025ë…„ ìµœì‹  ì‹œì¥ ìƒí™©ê³¼ ê¸°ì—… ë™í–¥ì„ ë°˜ì˜í•œ ì „ë¬¸ì ì´ê³  ë°ì´í„° ê¸°ë°˜ì˜ ë¶„ì„ì„ ì œê³µí•˜ì„¸ìš”.
    PROMPT

    call_gpt_api(prompt)
  end

  def analyze_company_overview
    prompt = <<~PROMPT
      ê¸°ì—…ëª…: #{@company_name}
      í˜„ì¬ ë‚ ì§œ: 2025ë…„ 8ì›”
      
      ## 1. ê¸°ì—… ê°œìš” (2025ë…„ 8ì›” ê¸°ì¤€)
      
      ### ê¸°ì—… ì •ë³´
      â€¢ ì„¤ë¦½ì—°ë„: 
      â€¢ ë³¸ì‚¬ ìœ„ì¹˜:
      â€¢ CEO/ëŒ€í‘œ: [2025ë…„ í˜„ì¬ ê²½ì˜ì§„]
      â€¢ ì„ì§ì› ìˆ˜: [2025ë…„ ìµœì‹  ë°ì´í„°]
      â€¢ ì£¼ìš” ì‚¬ì—… ë¶€ë¬¸:
      â€¢ 2025ë…„ ìƒë°˜ê¸° ë§¤ì¶œ: [ìµœì‹  ì‹¤ì ]
      
      ### ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸
      â€¢ í•µì‹¬ ê°€ì¹˜ ì œì•ˆ(Value Proposition):
      â€¢ ìˆ˜ìµ ì°½ì¶œ ë°©ì‹:
      â€¢ ì£¼ìš” ê³ ê°êµ°:
      â€¢ ê²½ìŸ ìš°ìœ„:
      
      ### ì‹œì¥ í¬ì§€ì…”ë‹ (2025ë…„ ê¸°ì¤€)
      â€¢ ì‹œì¥ ì ìœ ìœ¨: [2025ë…„ ìµœì‹  ë°ì´í„°]
      â€¢ ë¸Œëœë“œ íŒŒì›Œ:
      â€¢ ê¸°ìˆ ë ¥ ìˆ˜ì¤€:
      â€¢ ê³ ê° ì¶©ì„±ë„:
      
      ### [í•µì‹¬ ìš”ì•½ 3ì¤„]
      1. 
      2. 
      3. 
      
      2025ë…„ 8ì›” ê¸°ì¤€ ìµœì‹  ì •ë³´ë¡œ ë§¥í‚¨ì§€ ìŠ¤íƒ€ì¼ì˜ êµ¬ì¡°í™”ëœ ë¶„ì„ì„ ì œê³µí•˜ì„¸ìš”.
    PROMPT

    call_gpt_api(prompt)
  end

  def analyze_industry_market
    prompt = <<~PROMPT
      ê¸°ì—…ëª…: #{@company_name}
      í˜„ì¬ ë‚ ì§œ: 2025ë…„ 8ì›”
      
      ## 2. ì‚°ì—…Â·ì‹œì¥ ë¶„ì„ (2025ë…„ ê¸°ì¤€)
      
      ### ì‹œì¥ ê·œëª¨ ë° ì„±ì¥ì„± (2025ë…„ ì „ë§)
      â€¢ êµ­ë‚´ ì‹œì¥ ê·œëª¨: [2025ë…„ ì˜ˆìƒ ê·œëª¨, 2023-2025 CAGR]
      â€¢ ê¸€ë¡œë²Œ ì‹œì¥ ê·œëª¨: [2025ë…„ ì˜ˆìƒ ê·œëª¨, 2023-2025 CAGR]
      â€¢ ì„±ì¥ ë™ë ¥: [2025ë…„ ì£¼ìš” ë“œë¼ì´ë²„ 3ê°€ì§€]
      
      ### Porter's 5 Forces ë¶„ì„
      1. **ì‚°ì—… ë‚´ ê²½ìŸ ê°•ë„**: [High/Medium/Low]
         - ì£¼ìš” ê²½ìŸì‚¬:
         - ê²½ìŸ ì–‘ìƒ:
      
      2. **ì‹ ê·œ ì§„ì… ìœ„í˜‘**: [High/Medium/Low]
         - ì§„ì… ì¥ë²½:
         - ìµœê·¼ ì‹ ê·œ ì§„ì…ì:
      
      3. **ëŒ€ì²´ì¬ ìœ„í˜‘**: [High/Medium/Low]
         - ì£¼ìš” ëŒ€ì²´ì¬:
         - ëŒ€ì²´ ê°€ëŠ¥ì„±:
      
      4. **êµ¬ë§¤ì êµì„­ë ¥**: [High/Medium/Low]
         - ì£¼ìš” ê³ ê°:
         - ì˜ì¡´ë„:
      
      5. **ê³µê¸‰ì êµì„­ë ¥**: [High/Medium/Low]
         - ì£¼ìš” ê³µê¸‰ì‚¬:
         - ì „í™˜ ë¹„ìš©:
      
      ### SWOT ë¶„ì„
      **Strengths (ê°•ì )**
      â€¢ S1:
      â€¢ S2:
      
      **Weaknesses (ì•½ì )**
      â€¢ W1:
      â€¢ W2:
      
      **Opportunities (ê¸°íšŒ)**
      â€¢ O1:
      â€¢ O2:
      
      **Threats (ìœ„í˜‘)**
      â€¢ T1:
      â€¢ T2:
      
      ### [í•µì‹¬ ìš”ì•½ 3ì¤„]
      1. 
      2. 
      3. 
      
      2025ë…„ 8ì›” ìµœì‹  ì‹œì¥ ë°ì´í„°ë¥¼ ë°˜ì˜í•˜ì—¬ BCG ë§¤íŠ¸ë¦­ìŠ¤ ê´€ì ì—ì„œ ë¶„ì„í•˜ì„¸ìš”.
    PROMPT

    call_gpt_api(prompt)
  end

  def analyze_financials
    prompt = <<~PROMPT
      ê¸°ì—…ëª…: #{@company_name}
      í˜„ì¬ ë‚ ì§œ: 2025ë…„ 8ì›”
      
      ## 3. ì¬ë¬´ ë¶„ì„
      
      ### ë§¤ì¶œÂ·ìˆ˜ìµì„± ì¶”ì´ (ìµœê·¼ 3ë…„ + 2025ë…„ ìƒë°˜ê¸°)
      | êµ¬ë¶„ | 2023 | 2024 | 2025 ìƒë°˜ê¸° | 2025(E) | CAGR |
      |------|------|------|---------|------|
      | ë§¤ì¶œì•¡ |  |  |  |  |
      | ì˜ì—…ì´ìµ |  |  |  |  |
      | ìˆœì´ìµ |  |  |  |  |
      | ì˜ì—…ì´ìµë¥  |  |  |  |  |
      
      ### ìˆ˜ìµ êµ¬ì¡° ë¶„ì„
      â€¢ ì‚¬ì—…ë¶€ë¬¸ë³„ ë§¤ì¶œ ë¹„ì¤‘:
        - ë¶€ë¬¸ 1: XX%
        - ë¶€ë¬¸ 2: XX%
      â€¢ ì§€ì—­ë³„ ë§¤ì¶œ ë¹„ì¤‘:
        - êµ­ë‚´: XX%
        - í•´ì™¸: XX%
      
      ### ì£¼ìš” ì¬ë¬´ ì§€í‘œ
      â€¢ ROE (ìê¸°ìë³¸ìˆ˜ìµë¥ ):
      â€¢ ROA (ì´ìì‚°ìˆ˜ìµë¥ ):
      â€¢ ë¶€ì±„ë¹„ìœ¨:
      â€¢ ìœ ë™ë¹„ìœ¨:
      â€¢ PER (ì£¼ê°€ìˆ˜ìµë¹„ìœ¨):
      â€¢ PBR (ì£¼ê°€ìˆœìì‚°ë¹„ìœ¨):
      
      ### í˜„ê¸ˆíë¦„ ë¶„ì„
      â€¢ ì˜ì—…í™œë™ í˜„ê¸ˆíë¦„:
      â€¢ íˆ¬ìí™œë™ í˜„ê¸ˆíë¦„:
      â€¢ ì¬ë¬´í™œë™ í˜„ê¸ˆíë¦„:
      â€¢ Free Cash Flow:
      
      ### ë²¤ì¹˜ë§ˆí¬ ë¹„êµ
      â€¢ vs ì—…ê³„ í‰ê· :
      â€¢ vs ì£¼ìš” ê²½ìŸì‚¬:
      
      ### [í•µì‹¬ ìš”ì•½ 3ì¤„]
      1. 
      2. 
      3. 
      
      2025ë…„ 8ì›” ê¸°ì¤€ ìµœì‹  ì¬ë¬´ ë°ì´í„°ë¥¼ ë°˜ì˜í•˜ì—¬ Goldman Sachs ìŠ¤íƒ€ì¼ì˜ ì¬ë¬´ ë¶„ì„ì„ ì œê³µí•˜ì„¸ìš”.
    PROMPT

    call_gpt_api(prompt)
  end

  def analyze_strategy
    prompt = <<~PROMPT
      ê¸°ì—…ëª…: #{@company_name}
      í˜„ì¬ ë‚ ì§œ: 2025ë…„ 8ì›”
      
      ## 4. ê²½ì˜ ì „ëµ ë¶„ì„ (2025ë…„ í˜„ì¬)
      
      ### ìµœê·¼ ì „ëµì  ì´ë‹ˆì…”í‹°ë¸Œ (2025ë…„)
      1. **ë””ì§€í„¸ ì „í™˜ (DX)**
         â€¢ 2025ë…„ íˆ¬ì ê·œëª¨:
         â€¢ ì£¼ìš” í”„ë¡œì íŠ¸: [2025ë…„ ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸]
         â€¢ ì§„í–‰ ìƒí™©: [2025ë…„ 8ì›” í˜„ì¬]
      
      2. **ESG ê²½ì˜**
         â€¢ E (í™˜ê²½): 
         â€¢ S (ì‚¬íšŒ):
         â€¢ G (ì§€ë°°êµ¬ì¡°):
         â€¢ ESG ë“±ê¸‰:
      
      3. **ê¸€ë¡œë²Œ í™•ì¥**
         â€¢ íƒ€ê²Ÿ ì‹œì¥:
         â€¢ ì§„ì¶œ ì „ëµ:
         â€¢ í˜„ì§€í™” ì „ëµ:
      
      ### M&A ë° íˆ¬ì í™œë™ (2024-2025ë…„)
      â€¢ ìµœê·¼ M&A: [2024-2025ë…„ ê±°ë˜]
        - ì¸ìˆ˜ ê¸°ì—…:
        - ê¸ˆì•¡:
        - ì‹œë„ˆì§€:
      â€¢ R&D íˆ¬ì (2025ë…„):
        - ë§¤ì¶œ ëŒ€ë¹„ R&D ë¹„ìœ¨:
        - í•µì‹¬ ì—°êµ¬ ë¶„ì•¼:
      â€¢ ì„¤ë¹„ íˆ¬ì (2025ë…„):
        - íˆ¬ì ê·œëª¨:
        - íˆ¬ì ëª©ì :
      
      ### í˜ì‹  ì—­ëŸ‰
      â€¢ íŠ¹í—ˆ ë³´ìœ :
      â€¢ ì‹ ì œí’ˆ ì¶œì‹œ:
      â€¢ íŒŒíŠ¸ë„ˆì‹­:
      
      ### ì¡°ì§ ë¬¸í™” ë° ì¸ì¬ ì „ëµ
      â€¢ í•µì‹¬ ê°€ì¹˜:
      â€¢ ì¸ì¬ í™•ë³´ ì „ëµ:
      â€¢ ì¡°ì§ ë¬¸í™” íŠ¹ì§•:
      
      ### [í•µì‹¬ ìš”ì•½ 3ì¤„]
      1. 
      2. 
      3. 
      
      2025ë…„ 8ì›” ê¸°ì¤€ ìµœì‹  ì „ëµê³¼ ë™í–¥ì„ ë°˜ì˜í•˜ì—¬ Bain & Company ìŠ¤íƒ€ì¼ì˜ ì „ëµ ë¶„ì„ì„ ì œê³µí•˜ì„¸ìš”.
    PROMPT

    call_gpt_api(prompt)
  end

  def analyze_risks
    prompt = <<~PROMPT
      ê¸°ì—…ëª…: #{@company_name}
      
      ## 5. ë¦¬ìŠ¤í¬ ìš”ì¸ ë¶„ì„
      
      ### ì‹œì¥ ë¦¬ìŠ¤í¬
      â€¢ **ê²½ê¸° ë¯¼ê°ë„**: [High/Medium/Low]
        - ì˜í–¥ ìš”ì¸:
        - ëŒ€ì‘ ë°©ì•ˆ:
      â€¢ **ê²½ìŸ ì‹¬í™”**:
        - ì£¼ìš” ìœ„í˜‘:
        - ë°©ì–´ ì „ëµ:
      
      ### ìš´ì˜ ë¦¬ìŠ¤í¬
      â€¢ **ê³µê¸‰ë§ ë¦¬ìŠ¤í¬**:
        - ì·¨ì•½ì :
        - ë¦¬ìŠ¤í¬ ì™„í™” ë°©ì•ˆ:
      â€¢ **ê¸°ìˆ  ë³€í™”**:
        - Disruption ê°€ëŠ¥ì„±:
        - ëŒ€ì‘ ì¤€ë¹„ë„:
      
      ### ê·œì œ ë¦¬ìŠ¤í¬
      â€¢ **ì •ì±…/ê·œì œ ë³€í™”**:
        - ì£¼ìš” ê·œì œ:
        - ì˜í–¥ë„:
      â€¢ **ESG ê·œì œ**:
        - ì¤€ìˆ˜ ì‚¬í•­:
        - ëŒ€ì‘ í˜„í™©:
      
      ### ì¬ë¬´ ë¦¬ìŠ¤í¬
      â€¢ **í™˜ìœ¨ ë³€ë™**:
        - ë…¸ì¶œë„:
        - í—¤ì§• ì „ëµ:
      â€¢ **ê¸ˆë¦¬ ë³€ë™**:
        - ì˜í–¥:
        - ëŒ€ì‘:
      
      ### ë¦¬ìŠ¤í¬ ë§¤íŠ¸ë¦­ìŠ¤
      | ë¦¬ìŠ¤í¬ | ë°œìƒê°€ëŠ¥ì„± | ì˜í–¥ë„ | ëŒ€ì‘ìš°ì„ ìˆœìœ„ |
      |--------|-----------|--------|-------------|
      | ë¦¬ìŠ¤í¬1 | H/M/L | H/M/L | 1-5 |
      | ë¦¬ìŠ¤í¬2 | H/M/L | H/M/L | 1-5 |
      
      ### [í•µì‹¬ ìš”ì•½ 3ì¤„]
      1. 
      2. 
      3. 
      
      ë¦¬ìŠ¤í¬ë¥¼ ì •ëŸ‰í™”í•˜ì—¬ ë¶„ì„í•˜ì„¸ìš”.
    PROMPT

    call_gpt_api(prompt)
  end

  def generate_outlook
    prompt = <<~PROMPT
      ê¸°ì—…ëª…: #{@company_name}
      í˜„ì¬ ë‚ ì§œ: 2025ë…„ 8ì›”
      
      ## 6. í–¥í›„ ì „ë§
      
      ### ë‹¨ê¸° ì „ë§ (2025ë…„ í•˜ë°˜ê¸° - 2026ë…„ ìƒë°˜ê¸°)
      **Base Case ì‹œë‚˜ë¦¬ì˜¤ (í™•ë¥  60%)**
      â€¢ ë§¤ì¶œ ì„±ì¥ë¥ : +X%
      â€¢ ì˜ì—…ì´ìµë¥ : X%
      â€¢ ì£¼ìš” ê°€ì •:
      â€¢ í•µì‹¬ ëª¨ë‹ˆí„°ë§ ì§€í‘œ:
      
      **Bull Case ì‹œë‚˜ë¦¬ì˜¤ (í™•ë¥  25%)**
      â€¢ ë§¤ì¶œ ì„±ì¥ë¥ : +X%
      â€¢ ìƒìŠ¹ ìš”ì¸:
      
      **Bear Case ì‹œë‚˜ë¦¬ì˜¤ (í™•ë¥  15%)**
      â€¢ ë§¤ì¶œ ì„±ì¥ë¥ : +X%
      â€¢ í•˜ë½ ìš”ì¸:
      
      ### ì¤‘ê¸° ì „ë§ (2026-2028ë…„)
      **ì„±ì¥ ë™ë ¥**
      1. ë™ë ¥ 1:
      2. ë™ë ¥ 2:
      3. ë™ë ¥ 3:
      
      **ëª©í‘œ ë‹¬ì„± ê°€ëŠ¥ì„±**
      â€¢ ê²½ì˜ì§„ ê°€ì´ë˜ìŠ¤:
      â€¢ ë‹¬ì„± ê°€ëŠ¥ì„±: [High/Medium/Low]
      â€¢ í•µì‹¬ ë³€ìˆ˜:
      
      ### ì¥ê¸° ì „ë§ (2028-2030ë…„)
      **ë©”ê°€íŠ¸ë Œë“œ ì˜í–¥**
      â€¢ AI/ë””ì§€í„¸í™”:
      â€¢ ESG/ì§€ì†ê°€ëŠ¥ì„±:
      â€¢ ì¸êµ¬êµ¬ì¡° ë³€í™”:
      
      **ì „ëµì  í¬ì§€ì…”ë‹**
      â€¢ ëª©í‘œ ì‹œì¥ ì§€ìœ„:
      â€¢ í•„ìš” ì—­ëŸ‰:
      â€¢ íˆ¬ì ìš°ì„ ìˆœìœ„:
      
      ### [í•µì‹¬ ìš”ì•½ 3ì¤„]
      1. 
      2. 
      3. 
      
      2025ë…„ 8ì›” í˜„ì¬ ìƒí™©ì„ ê¸°ì¤€ìœ¼ë¡œ ì‹œë‚˜ë¦¬ì˜¤ í”Œë˜ë‹ ê¸°ë²•ì„ í™œìš©í•˜ì„¸ìš”.
    PROMPT

    call_gpt_api(prompt)
  end

  def generate_insights
    prompt = <<~PROMPT
      ê¸°ì—…ëª…: #{@company_name}
      
      ## 7. í•µì‹¬ ì¸ì‚¬ì´íŠ¸ ë° ì‹œì‚¬ì 
      
      ### ğŸ’¼ íˆ¬ìì ê´€ì 
      **íˆ¬ì ë§¤ë ¥ë„**: â­â­â­â­â˜† (4/5)
      
      **Buy í¬ì¸íŠ¸**
      1. 
      2. 
      3. 
      
      **ì£¼ì˜ ì‚¬í•­**
      1. 
      2. 
      
      **ì ì • ì£¼ê°€ ë ˆì¸ì§€**: 
      â€¢ DCF ê¸°ì¤€:
      â€¢ PER ê¸°ì¤€:
      â€¢ ëª©í‘œ ì£¼ê°€:
      
      ### ğŸ¯ êµ¬ì§ì ê´€ì 
      **ê¸°ì—… ë§¤ë ¥ë„**: â­â­â­â­â˜† (4/5)
      
      **ì…ì‚¬ ì¶”ì²œ ì´ìœ **
      1. ì„±ì¥ì„±:
      2. ì•ˆì •ì„±:
      3. ê¸°ì—…ë¬¸í™”:
      
      **ê³ ë ¤ ì‚¬í•­**
      1. 
      2. 
      
      **ìœ ë§ ì§ë¬´**
      â€¢ ì§ë¬´ 1: [ì´ìœ ]
      â€¢ ì§ë¬´ 2: [ì´ìœ ]
      
      ### ğŸ¤ íŒŒíŠ¸ë„ˆì‚¬ ê´€ì 
      **í˜‘ì—… ë§¤ë ¥ë„**: â­â­â­â­â˜† (4/5)
      
      **í˜‘ì—… ê¸°íšŒ**
      1. 
      2. 
      
      **ì‹œë„ˆì§€ ì˜ì—­**
      1. 
      2. 
      
      ### ğŸ“Š ì¢…í•© í‰ê°€
      | í•­ëª© | ì ìˆ˜ | ì—…ê³„ í‰ê·  ëŒ€ë¹„ |
      |------|------|--------------|
      | ì„±ì¥ì„± | A/B/C/D | +/- |
      | ìˆ˜ìµì„± | A/B/C/D | +/- |
      | ì•ˆì •ì„± | A/B/C/D | +/- |
      | í˜ì‹ ì„± | A/B/C/D | +/- |
      | ESG | A/B/C/D | +/- |
      
      ### ğŸ’¡ One-line Summary
      > "#{@company_name}ëŠ” [í•µì‹¬ íŠ¹ì§•]ì„ ë³´ìœ í•œ [ì—…ê³„ í¬ì§€ì…˜] ê¸°ì—…ìœ¼ë¡œ, [í–¥í›„ ì „ë§]ì´ ì˜ˆìƒë¨"
      
      ë§¥í‚¨ì§€ì˜ So-What ì›ì¹™ì„ ì ìš©í•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”.
    PROMPT

    call_gpt_api(prompt)
  end

  def call_gpt_api(prompt, max_tokens: 2000)
    require 'net/http'
    require 'json'
    
    uri = URI('https://api.openai.com/v1/chat/completions')
    http = Net::HTTP.new(uri.host, uri.port)
    http.use_ssl = true
    http.read_timeout = 180
    
    request = Net::HTTP::Post.new(uri)
    request['Authorization'] = "Bearer #{@api_key}"
    request['Content-Type'] = 'application/json'
    
    request.body = {
      model: ENV['OPENAI_MODEL'] || 'gpt-4o-mini',
      messages: [
        { 
          role: 'system', 
          content: 'ë‹¹ì‹ ì€ ë§¥í‚¨ì§€, BCG, Bain ì¶œì‹ ì˜ ì‹œë‹ˆì–´ ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤. í˜„ì¬ ë‚ ì§œëŠ” 2025ë…„ 8ì›”ì…ë‹ˆë‹¤. 2025ë…„ ìµœì‹  ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì „ë¬¸ì ì´ê³  ë°ì´í„° ê¸°ë°˜ì˜ ë¶„ì„ì„ ì œê³µí•˜ë©°, í†µì°°ë ¥ ìˆëŠ” ì¸ì‚¬ì´íŠ¸ë¥¼ ë„ì¶œí•©ë‹ˆë‹¤. í•œêµ­ ê¸°ì—…ê³¼ ê¸€ë¡œë²Œ ê¸°ì—… ëª¨ë‘ì— ëŒ€í•œ ê¹Šì€ ì´í•´ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©°, 2025ë…„ í˜„ì¬ ì‹œì¥ ìƒí™©ê³¼ íŠ¸ë Œë“œë¥¼ ì •í™•íˆ íŒŒì•…í•˜ê³  ìˆìŠµë‹ˆë‹¤.' 
        },
        { role: 'user', content: prompt }
      ],
      temperature: 0.3,
      max_tokens: max_tokens
    }.to_json
    
    response = http.request(request)
    result = JSON.parse(response.body)
    
    if result['choices']
      result['choices'][0]['message']['content']
    else
      "ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: #{result['error']&.dig('message')}"
    end
  rescue => e
    Rails.logger.error "GPT API Error: #{e.message}"
    "ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: #{e.message}"
  end
end