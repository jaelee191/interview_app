<div class="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 py-12">
  <div class="max-w-5xl mx-auto px-4">
    <!-- Header -->
    <div class="text-center mb-12">
      <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-full mb-4">
        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
      </div>
      <h1 class="text-4xl font-bold text-gray-900 mb-4">
        ğŸ“ ì±„ìš©ê³µê³  í…ìŠ¤íŠ¸ ë¶„ì„
      </h1>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        ì±„ìš©ê³µê³  ë‚´ìš©ì„ ì§ì ‘ ë¶™ì—¬ë„£ìœ¼ë©´ AIê°€ ì¦‰ì‹œ ë¶„ì„í•´ë“œë¦½ë‹ˆë‹¤
      </p>
    </div>

    <!-- Input Form -->
    <div class="bg-white shadow-2xl rounded-2xl p-8">
      <!-- Company & Position Info -->
      <div class="grid md:grid-cols-2 gap-6 mb-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">íšŒì‚¬ëª… *</label>
          <input 
            type="text" 
            id="company-name" 
            placeholder="ì˜ˆ: ì‚¼ì„±ì „ì" 
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
            required
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ì§€ì› ì§ë¬´ *</label>
          <input 
            type="text" 
            id="position" 
            placeholder="ì˜ˆ: ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ" 
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
            required
          />
        </div>
      </div>

      <!-- Job Posting Content -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">
          ì±„ìš©ê³µê³  ë‚´ìš© *
          <span class="text-xs text-gray-500 ml-2">(ì±„ìš© ì‚¬ì´íŠ¸ì—ì„œ ë³µì‚¬-ë¶™ì—¬ë„£ê¸°)</span>
        </label>
        <textarea 
          id="job-content" 
          rows="15"
          placeholder="ì±„ìš©ê³µê³  ì „ì²´ ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”.

ì˜ˆì‹œ:
[ëª¨ì§‘ë¶€ë¬¸]
â€¢ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ

[ë‹´ë‹¹ì—…ë¬´]
â€¢ ì›¹/ëª¨ë°”ì¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ
â€¢ ì‹œìŠ¤í…œ ì„¤ê³„ ë° êµ¬í˜„

[ìê²©ìš”ê±´]
â€¢ ì»´í“¨í„°ê³µí•™ ê´€ë ¨ í•™ê³¼ ì¡¸ì—…
â€¢ Java, Python ë“± í”„ë¡œê·¸ë˜ë° ì–¸ì–´ í™œìš© ê°€ëŠ¥

[ìš°ëŒ€ì‚¬í•­]
â€¢ ê´€ë ¨ í”„ë¡œì íŠ¸ ê²½í—˜
â€¢ ì˜¤í”ˆì†ŒìŠ¤ ê¸°ì—¬ ê²½í—˜

[ê·¼ë¬´ì¡°ê±´]
â€¢ ê·¼ë¬´ì§€: ì„œìš¸
â€¢ ê³ ìš©í˜•íƒœ: ì •ê·œì§"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none font-mono text-sm"
          required
        ></textarea>
        <div class="mt-2 flex justify-between items-center">
          <p class="text-sm text-gray-500">ìµœì†Œ 100ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
          <span id="char-count" class="text-sm text-gray-500">0ì</span>
        </div>
      </div>

      <!-- Source URL (Optional) -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">ì¶œì²˜ URL (ì„ íƒ)</label>
        <input 
          type="url" 
          id="source-url" 
          placeholder="https://www.saramin.co.kr/..." 
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
        />
      </div>

      <!-- Analyze Button -->
      <button 
        id="analyze-text-btn" 
        type="button"
        class="w-full px-6 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-lg hover:from-indigo-700 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg"
      >
        <span class="flex items-center justify-center">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
          </svg>
          ì±„ìš©ê³µê³  ë¶„ì„ ì‹œì‘
        </span>
      </button>
    </div>

    <!-- Loading State -->
    <div id="loading-state" class="hidden mt-8">
      <div class="bg-white rounded-2xl p-8 shadow-xl">
        <div class="flex flex-col items-center">
          <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-indigo-600 mb-4"></div>
          <p class="text-lg font-medium text-gray-700">ì±„ìš©ê³µê³ ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
          <p class="text-sm text-gray-500 mt-2">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” (ì•½ 10-20ì´ˆ ì†Œìš”)</p>
        </div>
      </div>
    </div>

    <!-- Analysis Result -->
    <div id="analysis-result" class="hidden mt-8">
      <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 px-8 py-6">
          <h2 class="text-2xl font-bold text-white">ğŸ“Š ì±„ìš©ê³µê³  ë¶„ì„ ê²°ê³¼</h2>
        </div>
        <div class="p-8">
          <div id="result-content" class="prose max-w-none">
            <!-- Analysis content will be inserted here -->
          </div>
          
          <!-- Action Buttons -->
          <div class="mt-8 pt-8 border-t border-gray-200">
            <div class="flex flex-col sm:flex-row gap-4">
              <button 
                id="use-for-cover-letter" 
                class="flex-1 px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition-colors"
              >
                ì´ ë¶„ì„ ê²°ê³¼ë¡œ ìì†Œì„œ ì‘ì„±í•˜ê¸°
              </button>
              <button 
                id="analyze-another" 
                class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors"
              >
                ë‹¤ë¥¸ ì±„ìš©ê³µê³  ë¶„ì„í•˜ê¸°
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tips -->
    <div class="mt-12 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-8">
      <h3 class="text-lg font-bold text-gray-900 mb-4">ğŸ’¡ ë³µì‚¬-ë¶™ì—¬ë„£ê¸° íŒ</h3>
      <ul class="space-y-3 text-gray-700">
        <li class="flex items-start">
          <span class="text-indigo-600 mr-2">1.</span>
          <span>ì±„ìš© ì‚¬ì´íŠ¸ì—ì„œ ì±„ìš©ê³µê³  ì „ì²´ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ì„ íƒ</span>
        </li>
        <li class="flex items-start">
          <span class="text-indigo-600 mr-2">2.</span>
          <span>Ctrl+C (Windows) ë˜ëŠ” Cmd+C (Mac)ë¡œ ë³µì‚¬</span>
        </li>
        <li class="flex items-start">
          <span class="text-indigo-600 mr-2">3.</span>
          <span>ìœ„ í…ìŠ¤íŠ¸ ì…ë ¥ë€ì— Ctrl+V (Windows) ë˜ëŠ” Cmd+V (Mac)ë¡œ ë¶™ì—¬ë„£ê¸°</span>
        </li>
        <li class="flex items-start">
          <span class="text-indigo-600 mr-2">4.</span>
          <span>íšŒì‚¬ëª…ê³¼ ì§€ì› ì§ë¬´ë¥¼ ì •í™•íˆ ì…ë ¥í•˜ë©´ ë” ì •í™•í•œ ë¶„ì„ ê°€ëŠ¥</span>
        </li>
      </ul>
    </div>
  </div>
</div>

<script>
(function() {
  'use strict';
  
  function ready(fn) {
    if (document.readyState !== 'loading') {
      fn();
    } else {
      document.addEventListener('DOMContentLoaded', fn);
    }
  }
  
  ready(function() {
    const analyzeBtn = document.getElementById('analyze-text-btn');
    const companyInput = document.getElementById('company-name');
    const positionInput = document.getElementById('position');
    const contentInput = document.getElementById('job-content');
    const urlInput = document.getElementById('source-url');
    const charCount = document.getElementById('char-count');
    const loadingState = document.getElementById('loading-state');
    const resultDiv = document.getElementById('analysis-result');
    const resultContent = document.getElementById('result-content');
    
    // Character count
    if (contentInput && charCount) {
      contentInput.addEventListener('input', function() {
        charCount.textContent = contentInput.value.length + 'ì';
      });
    }
    
    if (!analyzeBtn) return;
    
    analyzeBtn.addEventListener('click', async function(e) {
      e.preventDefault();
      
      const company = companyInput.value.trim();
      const position = positionInput.value.trim();
      const content = contentInput.value.trim();
      const sourceUrl = urlInput.value.trim();
      
      // Validation
      if (!company) {
        alert('íšŒì‚¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        companyInput.focus();
        return;
      }
      
      if (!position) {
        alert('ì§€ì› ì§ë¬´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        positionInput.focus();
        return;
      }
      
      if (!content || content.length < 100) {
        alert('ì±„ìš©ê³µê³  ë‚´ìš©ì„ 100ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        contentInput.focus();
        return;
      }
      
      // Show loading
      loadingState.classList.remove('hidden');
      resultDiv.classList.add('hidden');
      analyzeBtn.disabled = true;
      analyzeBtn.style.opacity = '0.5';
      
      try {
        const csrfToken = document.querySelector('meta[name="csrf-token"]');
        const token = csrfToken ? csrfToken.content : '';
        
        const response = await fetch('/cover_letters/analyze_job_text', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRF-Token': token,
            'Accept': 'application/json'
          },
          body: JSON.stringify({
            company_name: company,
            position: position,
            content: content,
            source_url: sourceUrl
          })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.success) {
          displayResults(data.analysis);
          loadingState.classList.add('hidden');
          resultDiv.classList.remove('hidden');
          resultDiv.scrollIntoView({ behavior: 'smooth' });
        } else {
          throw new Error(data.error || 'ë¶„ì„ ì‹¤íŒ¨');
        }
        
      } catch (error) {
        console.error('Error:', error);
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        loadingState.classList.add('hidden');
      } finally {
        analyzeBtn.disabled = false;
        analyzeBtn.style.opacity = '1';
      }
    });
    
    function displayResults(analysis) {
      if (!analysis) return;
      
      let html = analysis
        .replace(/### (.*?)$/gm, '<h3 class="text-xl font-bold text-gray-900 mt-6 mb-3">$1</h3>')
        .replace(/## (.*?)$/gm, '<h2 class="text-2xl font-bold text-gray-900 mt-8 mb-4 pb-2 border-b">$1</h2>')
        .replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold">$1</strong>')
        .replace(/^\* (.*?)$/gm, '<li class="ml-6 mb-1">â€¢ $1</li>')
        .replace(/^- (.*?)$/gm, '<li class="ml-6 mb-1">â€¢ $1</li>')
        .replace(/^(\d+)\. (.*?)$/gm, '<div class="ml-6 mb-2"><strong>$1.</strong> $2</div>')
        .replace(/\n\n/g, '</p><p class="mb-4 text-gray-700 leading-relaxed">');
      
      if (!html.startsWith('<')) {
        html = '<p class="mb-4 text-gray-700 leading-relaxed">' + html + '</p>';
      }
      
      resultContent.innerHTML = html;
    }
    
    // Other buttons
    const useForCoverLetterBtn = document.getElementById('use-for-cover-letter');
    const analyzeAnotherBtn = document.getElementById('analyze-another');
    
    if (useForCoverLetterBtn) {
      useForCoverLetterBtn.addEventListener('click', function() {
        window.location.href = '/cover_letters/new?from_job_analysis=true';
      });
    }
    
    if (analyzeAnotherBtn) {
      analyzeAnotherBtn.addEventListener('click', function() {
        companyInput.value = '';
        positionInput.value = '';
        contentInput.value = '';
        urlInput.value = '';
        charCount.textContent = '0ì';
        resultDiv.classList.add('hidden');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }
  });
})();
</script>