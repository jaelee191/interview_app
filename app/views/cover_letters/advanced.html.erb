<div class="min-h-screen bg-gradient-to-br from-gray-50 to-white py-12">
  <div class="max-w-4xl mx-auto px-4">
    <!-- Header -->
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold text-gray-900 mb-4">
        🎯 3단계 AI 심층 분석
      </h1>
      <p class="text-lg text-gray-600">
        기업 분석 → 자소서 평가 → 맞춤형 자소서 생성까지
      </p>
      <div class="flex justify-center items-center mt-6 space-x-8">
        <div class="flex items-center">
          <div class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">1</div>
          <span class="ml-2 text-sm font-medium">기업 분석</span>
        </div>
        <div class="h-px w-12 bg-gray-300"></div>
        <div class="flex items-center">
          <div class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">2</div>
          <span class="ml-2 text-sm font-medium">자소서 평가</span>
        </div>
        <div class="h-px w-12 bg-gray-300"></div>
        <div class="flex items-center">
          <div class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">3</div>
          <span class="ml-2 text-sm font-medium">맞춤 생성</span>
        </div>
      </div>
    </div>

    <!-- Form -->
    <%= form_with(model: @cover_letter, url: analyze_advanced_cover_letters_path, local: true, class: "bg-white shadow-xl rounded-2xl p-8") do |form| %>
      <% if @cover_letter.errors.any? %>
        <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
          <p class="text-red-800 font-semibold mb-2">다음 오류를 확인해주세요:</p>
          <ul class="list-disc list-inside text-red-700">
            <% @cover_letter.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <!-- PDF Upload Section -->
      <div class="mb-8 p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl">
        <h3 class="font-bold text-gray-900 mb-4">📄 이력서/자소서 PDF 업로드 (선택)</h3>
        <div class="space-y-4">
          <div class="flex items-center justify-center w-full">
            <label for="pdf-upload" class="flex flex-col items-center justify-center w-full h-32 border-2 border-purple-300 border-dashed rounded-lg cursor-pointer bg-white hover:bg-purple-50 transition-colors">
              <div class="flex flex-col items-center justify-center pt-5 pb-6">
                <svg class="w-8 h-8 mb-3 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                </svg>
                <p class="mb-2 text-sm text-gray-700"><span class="font-semibold">클릭하여 PDF 업로드</span></p>
                <p class="text-xs text-gray-500">PDF 파일만 가능 (최대 10MB)</p>
              </div>
              <input id="pdf-upload" type="file" class="hidden" accept=".pdf" />
            </label>
          </div>
          <div id="pdf-info" class="hidden">
            <div class="bg-white p-4 rounded-lg border border-purple-200">
              <div class="flex items-center justify-between">
                <div class="flex items-center">
                  <svg class="w-6 h-6 text-purple-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9 2a2 2 0 00-2 2v8a2 2 0 002 2h6a2 2 0 002-2V6.414A2 2 0 0016.414 5L14 2.586A2 2 0 0012.586 2H9z"></path>
                  </svg>
                  <span id="pdf-filename" class="text-sm font-medium text-gray-700"></span>
                </div>
                <button id="remove-pdf" class="text-red-500 hover:text-red-700">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Features -->
      <div class="mb-8 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl">
        <h3 class="font-bold text-gray-900 mb-4">✨ 3단계 심층 분석의 특별함</h3>
        <div class="grid md:grid-cols-3 gap-4">
          <div class="flex items-start">
            <span class="text-2xl mr-3">🏢</span>
            <div>
              <p class="font-semibold text-gray-800">기업 분석</p>
              <p class="text-sm text-gray-600">최신 현안과 인재상 파악</p>
            </div>
          </div>
          <div class="flex items-start">
            <span class="text-2xl mr-3">📊</span>
            <div>
              <p class="font-semibold text-gray-800">15년 경력 평가</p>
              <p class="text-sm text-gray-600">인사팀 선배의 디테일한 조언</p>
            </div>
          </div>
          <div class="flex items-start">
            <span class="text-2xl mr-3">✍️</span>
            <div>
              <p class="font-semibold text-gray-800">맞춤형 생성</p>
              <p class="text-sm text-gray-600">기업별 최적화된 자소서</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Basic Information -->
      <div class="space-y-6">
        <div>
          <%= form.label :user_name, "이름", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.text_field :user_name, 
              placeholder: "홍길동",
              class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <%= form.label :company_name, "지원 기업", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_field :company_name, 
                placeholder: "삼성전자",
                class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
          </div>

          <div>
            <%= form.label :position, "지원 직무", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_field :position, 
                placeholder: "소프트웨어 개발",
                class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
          </div>
        </div>

        <div>
          <%= form.label :title, "제목", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.text_field :title, 
              placeholder: "2025 상반기 신입 자기소개서",
              class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
        </div>

        <div>
          <%= form.label :content, "자기소개서 내용", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <div class="relative">
            <%= form.text_area :content, 
                rows: 15,
                placeholder: "자기소개서 내용을 입력해주세요.\n\n예시:\n저는 대학에서 컴퓨터공학을 전공하며...",
                class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none" %>
            <div class="absolute bottom-4 right-4 text-sm text-gray-400">
              <span id="char-count">0</span> / 5000자
            </div>
          </div>
        </div>
      </div>

      <!-- Process Description -->
      <div class="mt-8 p-6 bg-gray-50 rounded-xl">
        <h4 class="font-bold text-gray-900 mb-3">📋 분석 프로세스</h4>
        <ol class="space-y-2 text-sm text-gray-700">
          <li class="flex items-start">
            <span class="font-semibold mr-2">1단계:</span>
            <span>기업의 핵심 사업, 최근 현안, 인재상을 분석합니다</span>
          </li>
          <li class="flex items-start">
            <span class="font-semibold mr-2">2단계:</span>
            <span>15년 경력 인사팀 선배의 관점으로 자소서를 평가합니다</span>
          </li>
          <li class="flex items-start">
            <span class="font-semibold mr-2">3단계:</span>
            <span>분석 결과를 바탕으로 맞춤형 자소서를 생성합니다</span>
          </li>
        </ol>
      </div>

      <!-- Submit Button -->
      <div class="mt-8 flex justify-center">
        <%= form.submit "🚀 3단계 심층 분석 시작", 
            class: "px-8 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-indigo-700 transform hover:scale-105 transition-all duration-200 cursor-pointer shadow-lg" %>
      </div>
    <% end %>

    <!-- Links -->
    <div class="mt-8 text-center space-y-2">
      <p class="text-gray-600">다른 분석 방법을 원하시나요?</p>
      <div class="flex justify-center space-x-4">
        <%= link_to "📝 기본 분석", new_cover_letter_path, class: "text-blue-600 hover:text-blue-800" %>
        <%= link_to "💬 AI와 대화하며 작성", interactive_cover_letters_path, class: "text-blue-600 hover:text-blue-800" %>
      </div>
    </div>
  </div>
</div>

<script>
  // Character count and PDF upload
  document.addEventListener('turbo:load', () => {
    const textarea = document.querySelector('textarea[name="cover_letter[content]"]');
    const charCount = document.getElementById('char-count');
    
    if (textarea && charCount) {
      const updateCount = () => {
        charCount.textContent = textarea.value.length;
      };
      
      textarea.addEventListener('input', updateCount);
      updateCount();
    }
    
    // PDF Upload functionality
    const pdfUpload = document.getElementById('pdf-upload');
    const pdfInfo = document.getElementById('pdf-info');
    const pdfFilename = document.getElementById('pdf-filename');
    const removePdf = document.getElementById('remove-pdf');
    let selectedFile = null;
    
    if (pdfUpload) {
      pdfUpload.addEventListener('change', function(e) {
        const file = e.target.files[0];
        
        if (file) {
          // Validate file type
          if (file.type !== 'application/pdf') {
            alert('PDF 파일만 업로드 가능합니다.');
            this.value = '';
            return;
          }
          
          // Validate file size (10MB)
          if (file.size > 10 * 1024 * 1024) {
            alert('파일 크기는 10MB 이하여야 합니다.');
            this.value = '';
            return;
          }
          
          selectedFile = file;
          pdfFilename.textContent = file.name;
          pdfInfo.classList.remove('hidden');
          
          // Add hidden input for file
          const existingInput = document.getElementById('pdf-file-data');
          if (existingInput) {
            existingInput.remove();
          }
          
          // Create FormData for file upload
          const reader = new FileReader();
          reader.onload = function(e) {
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.id = 'pdf-file-data';
            hiddenInput.name = 'cover_letter[pdf_content]';
            hiddenInput.value = e.target.result;
            document.querySelector('form').appendChild(hiddenInput);
          };
          reader.readAsDataURL(file);
        }
      });
    }
    
    if (removePdf) {
      removePdf.addEventListener('click', function(e) {
        e.preventDefault();
        selectedFile = null;
        pdfUpload.value = '';
        pdfInfo.classList.add('hidden');
        pdfFilename.textContent = '';
        
        // Remove hidden input
        const hiddenInput = document.getElementById('pdf-file-data');
        if (hiddenInput) {
          hiddenInput.remove();
        }
      });
    }
  });
</script>