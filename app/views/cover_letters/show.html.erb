<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
  <!-- 페이지 헤더 -->
  <div class="text-center mb-12">
    <h1 class="text-2xl font-semibold text-gray-900 mb-3">
      자소서 분석 결과
    </h1>
    <p class="text-base text-gray-600">
      당신의 경험과 역량을 분석했습니다
    </p>
        
    
  </div>

  <!-- 분석 정보 카드 -->
  <div class="bg-gray-50 rounded-lg border border-gray-100 p-6 mb-12">
    <div class="flex flex-wrap items-center justify-center gap-6">
      <% if @cover_letter.company_name.present? %>
        <div class="flex items-center gap-2">
          <span class="text-gray-500">지원 기업</span>
          <span class="font-semibold text-gray-900"><%= @cover_letter.company_name %></span>
        </div>
      <% end %>
      <% if @cover_letter.position.present? %>
        <div class="flex items-center gap-2">
          <span class="text-gray-500">지원 직무</span>
          <span class="font-semibold text-gray-900"><%= @cover_letter.position %></span>
        </div>
      <% end %>
      <div class="flex items-center gap-2">
        <span class="text-gray-500">분석일</span>
        <span class="font-semibold text-gray-900"><%= @cover_letter.created_at.strftime("%Y.%m.%d") %></span>
      </div>
    </div>
  </div>

  <!-- Python NLP 분석 결과 -->
  <% if @cover_letter.deep_analysis_data && @cover_letter.deep_analysis_data['python_analysis'] %>
    <% @python_analysis = @cover_letter.deep_analysis_data['python_analysis'] %>
    <%= render 'python_analysis_result' %>
  <% end %>

  <!-- 메인 분석 결과 -->
  <% if @cover_letter.analysis_result.present? %>
    <!-- AI 분석 결과 섹션별 표시 -->
    <% sections = parse_analysis_sections(@cover_letter.analysis_result) %>
    
    <% if sections[:first_impression].present? %>
      <div class="mb-16">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">🎯 첫인상 & 전체 평가</h2>
        <div class="bg-white rounded-xl shadow-sm p-8">
          <div class="text-gray-700 leading-loose space-y-4">
            <%= TextFormatterService.new.format_full_analysis(sections[:first_impression]) %>
          </div>
        </div>
      </div>
    <% end %>

    <% if sections[:strengths].present? %>
      <div class="mb-16">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">✨ 잘 쓴 부분</h2>
        <p class="text-sm text-gray-600 mb-6">발견한 강점들입니다</p>
        
        <div class="space-y-6">
          <% parse_numbered_items(sections[:strengths]).each_with_index do |item, index| %>
            <div class="bg-white rounded-xl shadow-sm p-6 hover:shadow-md transition-shadow">
              <div class="flex items-start">
                <div class="w-8 h-8 bg-emerald-50 rounded-full flex items-center justify-center mr-4 flex-shrink-0">
                  <span class="text-emerald-600 font-medium text-sm"><%= item[:number] %></span>
                </div>
                <div class="flex-1">
                  <% if item[:title].present? && item[:title] != '' %>
                    <h3 class="font-semibold text-gray-900 mb-2"><%= item[:title] %></h3>
                  <% end %>
                  <div class="text-gray-700 text-sm leading-relaxed"><%= TextFormatterService.new.format_section_text(item[:content]) %></div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <% if sections[:improvements].present? %>
      <div class="mb-16">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">🎨 개선이 필요한 부분</h2>
        <p class="text-sm text-gray-600 mb-6">개선 포인트입니다</p>
        
        <div class="space-y-6">
          <% parse_numbered_items(sections[:improvements]).each do |item| %>
            <div class="bg-white rounded-xl shadow-sm p-6 hover:shadow-md transition-shadow">
              <div class="flex items-start">
                <div class="w-8 h-8 bg-amber-50 rounded-full flex items-center justify-center mr-4 flex-shrink-0">
                  <span class="text-amber-600 font-medium text-sm"><%= item[:number] %></span>
                </div>
                <div class="flex-1">
                  <% if item[:title].present? && item[:title] != '' %>
                    <h3 class="font-semibold text-gray-900 mb-2"><%= item[:title] %></h3>
                  <% end %>
                  <div class="text-gray-700 text-sm leading-relaxed"><%= TextFormatterService.new.format_section_text(item[:content]) %></div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>


    <% if sections[:encouragement].present? %>
      <div class="mb-16">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">💚 격려와 응원</h2>
        <div class="bg-gradient-to-br from-emerald-50 to-green-50 rounded-xl p-8">
          <div class="text-emerald-800 leading-loose">
            <%= TextFormatterService.new.format_section_text(sections[:encouragement]) %>
          </div>
        </div>
      </div>
    <% end %>

    <!-- 전체 분석 원문 -->
    <div class="mb-12">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">📄 전체 분석 내용</h2>
      <div class="bg-gray-50 rounded-xl p-8">
        <% if @cover_letter.analysis_result.present? %>
          <div class="text-gray-700 leading-loose space-y-6">
            <%= TextFormatterService.new.format_full_analysis(@cover_letter.analysis_result) %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- 액션 버튼 섹션 -->
    <div class="text-center">
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-2">다음 단계</h3>
        <p class="text-sm text-gray-600">피드백을 반영해 개선해보세요</p>
      </div>
      
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <%= button_to rewrite_with_feedback_cover_letter_path(@cover_letter), 
            method: :post,
            class: "px-6 py-3 bg-emerald-500 text-white rounded-full hover:bg-emerald-600 transition-colors font-medium" do %>
          피드백 반영하여 리라이트
        <% end %>
        
        <%= link_to advanced_cover_letters_path, 
            class: "px-6 py-3 bg-white border border-gray-200 text-gray-700 rounded-full hover:bg-gray-50 transition-colors font-medium" do %>
          새 분석 시작
        <% end %>
      </div>
    </div>
    
  <% else %>
    <!-- 분석 중 -->
    <div class="bg-white rounded-lg border border-gray-100 p-12 text-center">
      <div class="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8 text-emerald-600 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
        </svg>
      </div>
      <h3 class="text-xl font-semibold text-gray-900 mb-2">분석 중입니다</h3>
      <p class="text-gray-600">AI가 자소서를 분석하고 있습니다. 잠시만 기다려주세요...</p>
    </div>
  <% end %>
</div>