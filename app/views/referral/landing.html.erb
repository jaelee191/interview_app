<div class="bg-white">
  <section class="py-16 bg-gray-50 border-b border-gray-100">
    <div class="max-w-4xl mx-auto px-4 text-center">
      <h1 class="text-3xl md:text-4xl font-bold text-gray-900">친구에게 추천하고 3건 보너스 받기</h1>
      <p class="text-gray-600 mt-3">링크를 공유하면 가입 시 서로 3건을 드립니다. 여러분의 합격 스토리를 함께 만들어 보세요.</p>
      <div class="mt-6 inline-flex items-center gap-2">
        <% if current_user %>
          <% link = referral_redirect_url(code: current_user.referral_code) %>
          <input id="shareLink" class="w-72 px-3 py-2 text-sm border border-gray-200 rounded-lg" value="<%= link %>" readonly>
          <button id="copyShare" class="px-4 py-2 text-sm font-medium text-white bg-emerald-500 rounded-lg hover:bg-emerald-600">링크 복사</button>
        <% else %>
          <%= link_to "로그인하고 링크 받기", new_user_session_path, class: "px-4 py-2 text-sm font-medium text-white bg-emerald-500 rounded-full hover:bg-emerald-600" %>
        <% end %>
      </div>
    </div>
  </section>

  <section class="py-16">
    <div class="max-w-5xl mx-auto px-4 grid md:grid-cols-2 gap-8">
      <div>
        <h2 class="text-xl font-semibold text-gray-900">이용자 반응</h2>
        <div class="mt-4 space-y-4">
          <% @reviews.each do |r| %>
            <div class="bg-white rounded-xl border border-gray-100 p-4">
              <div class="text-sm text-gray-700"><%= r.content %></div>
              <div class="text-xs text-gray-500 mt-2"><%= r.user&.email %> • <%= r.created_at.strftime('%Y.%m.%d') %></div>
            </div>
          <% end %>
          <% if @reviews.empty? %>
            <p class="text-sm text-gray-500">첫 번째 후기를 남겨보세요.</p>
          <% end %>
        </div>
      </div>
      <div>
        <h2 class="text-xl font-semibold text-gray-900">내 리뷰 남기기</h2>
        <% if current_user %>
          <%= form_with url: referral_reviews_path, method: :post, local: true, class: "mt-4" do %>
            <textarea name="content" rows="4" maxlength="500" class="w-full border border-gray-200 rounded-lg p-3 text-sm" placeholder="서비스를 사용해 본 느낌을 자유롭게 남겨주세요."></textarea>
            <div class="mt-3 text-right">
              <button class="px-4 py-2 text-sm font-medium text-white bg-gray-900 rounded-lg hover:bg-gray-800">리뷰 등록</button>
            </div>
          <% end %>
        <% else %>
          <p class="text-sm text-gray-600 mt-3">리뷰를 남기려면 <%= link_to '로그인', new_user_session_path, class: 'text-emerald-600 hover:text-emerald-700' %> 해주세요.</p>
        <% end %>
      </div>
    </div>
  </section>
</div>

<script>
  document.getElementById('copyShare')?.addEventListener('click', async function(){
    try {
      await navigator.clipboard.writeText(document.getElementById('shareLink').value);
      alert('추천 링크가 복사되었습니다!');
    } catch(e) { alert('복사에 실패했습니다.'); }
  });
</script>


